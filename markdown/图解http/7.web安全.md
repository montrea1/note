## 7.Web安全

#### http缺点

-   **1.通信使用明文（不加密），内容可能会被窃听**

    -   **TCP/IP 是可能被窃听的网络**
        -   按 TCP/IP 协议族的工作机制，通信内容在所有的通信线路上都有可能遭到窥视。
    -   **信息加密**
        -   通信加密.
            -   HTTP 协议中没有加密机制，但可以通过和 SSL（Secure Socket Layer，安全套接层）或 TLS（Transport Layer Security，安全层传输协议）的组合使用，加密 HTTP 的通信内容。
        -   通信内容加密
            -   把 HTTP 报文里所含的内容进行加密处理。
            -   要求客户端和服务器同时具备加密和解密机制。

-   **2.不验证通信方的身份，因此有可能遭遇伪装**

    -   **任何人都可发起请求**

        -   在 HTTP 协议通信时，由于不存在确认通信方的处理步骤，任何人都可以发起请求

        -   发送端的 IP 地址和端口号没有被 Web 服务器设定限制访问，服务器**只要接收到请**求，不管对方是谁都会**返回一个响应**

        -   ```java
                无法确定请求发送至目标的 Web 服务器是否是按真实意图返回响应的那台服务器。有可能是已伪装的 Web 服务器。

                无法确定响应返回到的客户端是否是按真实意图接收响应的那个客户端。有可能是已伪装的客户端。

                无法确定正在通信的对方是否具备访问权限。因为某些 Web 服务器上保存着重要的信息，只想发给特定用户通信的权限。

                无法判定请求是来自何方、出自谁手。

                即使是无意义的请求也会照单全收。无法阻止海量请求下的 DoS 攻击（Denial of Service，拒绝服务攻击）。

            ```

    -   **查明对手的证书**

        -   SSL 不仅提供加密处理，而且还使用了一种被称为证书的手段，可用于确定方。
        -   证书由值得信任的第三方机构颁发，用以证明服务器和客户端是实际存在的

-   **3.无法证明报文的完整性，所以有可能已遭篡改**

    -   **接收到的内容可能有误**
        -   由于 HTTP 协议无法证明通信的报文完整性，因此，在请求或响应送出之后直到对方接收之前的这段时间内，即使请求或响应的内容遭到篡改，也没有办法获悉。

    ​

    #### https

    添加了加密及认证机制的 HTTP 称为 HTTPS

    HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用 SSL（Secure Socket Layer）和 TLS（Transport Layer Security）协议代替而已。

    ![avatar](/img/8.jpeg)

**加密**

-   公钥加密
    -   加密和解密同用一个密钥的方式称为共享密钥加密（Common key crypto system），也被叫做对称密钥加密。
    -   任何人只要持有密钥就能解密了。如果密钥被攻击者获得，那加密也就失去了意义。
    -   缺点：无法证明公开密钥本身就是货真价实的公开密钥
-   非对称的密钥
    -   一把叫做私有密钥（private key），另一把叫做公开密钥（public key）。顾名思义，私有密钥不能让其他任何人知道，而公开密钥则可以随意发布，任何人都可以获得。
    -   **发送密文的一方**使用对方的**公开密钥进行加密**处理，对方**收到被加密的信息**后，再使用自己的**私有密钥进行解密。**
-   **HTTPS 采用混合加密机制**
    -   若密钥能够实现安全交换，那么有可能会考虑仅使用公开密钥加密来通信。但是公开密钥加密与共享密钥加密相比，其处理速度要慢。

#### 证书

-   公钥证书

    -   服务器会将这份由数字证书认证机构颁发的**公钥证书**发送给客户端，**以进行公开密钥加密方式通信**。公钥证书也可叫做数字证书或直接称为证书。

        ![avatar](/img/10.jpeg)

**https通信**

![avatar](/img/9.jpeg)

步骤 1： 客户端通过发送 Client Hello 报文开始 SSL 通信。报文中包含客户端支持的 SSL 的指定版本、加密组件（Cipher Suite）列表（所使用的加密算法及密钥长度等）。

步骤 2： 服务器可进行 SSL 通信时，会以 Server Hello 报文作为应答。和客户端一样，在报文中包含 SSL 版本以及加密组件。服务器的加密组件内容是从接收到的客户端加密组件内筛选出来的。

步骤 3： 之后服务器发送 Certificate 报文。报文中包含公开密钥证书。

步骤 4： 最后服务器发送 Server Hello Done 报文通知客户端，最初阶段的 SSL 握手协商部分结束。

步骤 5： SSL 第一次握手结束之后，客户端以 Client Key Exchange 报文作为回应。报文中包含通信加密中使用的一种被称为 Pre-master secret 的随机密码串。该报文已用步骤 3 中的公开密钥进行加密。

步骤 6： 接着客户端继续发送 Change Cipher Spec 报文。该报文会提示服务器，在此报文之后的通信会采用 Pre-master secret 密钥加密。

步骤 7： 客户端发送 Finished 报文。该报文包含连接至今全部报文的整体校验值。这次握手协商是否能够成功，要以服务器是否能够正确解密该报文作为判定标准。

步骤 8： 服务器同样发送 Change Cipher Spec 报文。

步骤 9： 服务器同样发送 Finished 报文。

步骤 10： 服务器和客户端的 Finished 报文交换完毕之后，SSL 连接就算建立完成。当然，通信会受到 SSL 的保护。从此处开始进行应用层协议的通信，即发送 HTTP 请求。

步骤 11： 应用层协议通信，即发送 HTTP 响应。

步骤 12： 最后由客户端断开连接。断开连接时，发送 close_notify 报文。上图做了一些省略，这步之后再发送 TCP FIN 报文来关闭与 TCP 的通信。



![avatar](/img/11.jpeg)