## JMM java内存模型

#### 1.线程与JVM

-   基本概念
    -   程序
        -   代码、完成某件任务、代码序列、静态概念
    -   进程
        -   程序在某些数据上的**一次运行**、动态概念
    -   线程
        -   一个进程包含一个或多个线程（占有资源的独立单元）
        -   java程序运行的基本单元
-   jvm与线程
    -   启动时机
        -   类被调用 jvm线程→其它线程(main)
    -   线程在jvm中
-   jvm内存区域
    -   方法区
        -   加载的类型信息 classloader
        -   类信息、常量、static、jit
        -   反射加载
        -   信息共享 （堆区）
    -   堆区
        -   实例对象
        -   GC
        -   信息共享 （方法区）
        -   异常OOM
    -   VM Stack
        -   java方法运行时的内存模型
        -   栈结构
        -   存放**栈帧**  每一个方法都有唯一一个对应的栈帧
        -   **栈帧存放数据:**局部变量、引用类型的数据的地址、操作数栈
        -   **异常:**内存溢出(OOM),栈帧满
    -   PC程序计数器
        -   java**线程的私有数据**→下一条指令的地址
    -   Native Method Stack 本地方法栈
-   jvm内存模型(规范)
    -   主内存
        -   内存
        -   共享信息
    -   工作内存
        -   工作空间，线程私有
        -   **基本数据**类型→工作空间; 
        -   **引用地址**存放→工作空间
        -   **引用对象**存放→堆
        -   由主存分配
    -   工作方式
        -   线程修改私有数据→直接在工作空间修改
        -   线程修改共享数据→把数据复制到工作空间修改→修改完刷新内存
    -   线程不安全
        -   多个线程同时读写一个共享数据****
        -   **处理:** 
            -   1.总线加锁(BUS)、降低cpu吞吐量
            -   2.缓存一致性协(MESI)
    -   jvm和jmm对应关系
        -   工作空间→ VM Stack、PC
        -   jmm概念→jvm根据概念划分结果

#### 2.java线程与硬件处理器

```java
任务  →  →  线程池   →  →   线程   →  →   内核线程   →  →   内核 →  →   cpu
```

-   java内存模型存在的必要性
    -   规范内存数据和工作空间数据的交互

#### 3.并发编程的三个重要特性

-   原子性

    -   不可分割
    -   1) x=10; 私有数据有原子性,共享数据没有原子性
    -   2) i++; 没有原子性
    -   多个原子性操作,合并到一起,没有原子性
    -   保证原子性
        -   Synchronized
        -   JUC Lock .ock

-   可见性

    -   线程只能操作自己工作空间中的数据
    -   实现
        -   Volatile .在JMM上实现了MESI协议
        -   Synchronized 加锁
        -   JUC Lock.lock

-   有序性

    -   程序中的数据不一定是执行的顺序
    -   实现：编译重排(代码)、指令重排(运行期)
        -   Volatile
        -   Synchronized
        -   **Happens-before原则**
            -   程序次数原则: 结果不变
            -   锁定原则: 后一次加锁必须要等前一次解锁
            -   Volatile原则
            -   传递原则:A→B→C   A→C

    ​

​	



